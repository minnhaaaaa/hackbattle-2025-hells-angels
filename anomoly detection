from sklearn.ensemble import IsolationForest
import matplotlib.pyplot as plt

# Assuming mock_df is your generated DataFrame
# Ensure 'amount' column is numeric
mock_df['amount'] = pd.to_numeric(mock_df['amount'])

# Initialize Isolation Forest
model = IsolationForest(contamination=0.05, random_state=42)  # assume ~5% anomalies
mock_df['anomaly'] = model.fit_predict(mock_df[['amount']])

# -1 = anomaly, 1 = normal
anomalies = mock_df[mock_df['anomaly'] == -1]

print("Anomalous transactions:")
print(anomalies)

# Optional: Visualize the anomalies
plt.figure(figsize=(10,6))
plt.scatter(mock_df.index, mock_df['amount'], c=mock_df['anomaly'], cmap='coolwarm', label='Transactions')
plt.xlabel('Transaction Index')
plt.ylabel('Amount')
plt.title('Transaction Amounts with Anomalies Highlighted')
plt.show()
